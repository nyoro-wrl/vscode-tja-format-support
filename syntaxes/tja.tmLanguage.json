{
  "scopeName": "source.tja",
  "patterns": [
    {
      "include": "#comment"
    },
    {
      "include": "#header"
    },
    {
      "include": "#chart"
    },
    {
      "include": "#commandBranch"
    },
    {
      "include": "#command"
    }
  ],
  "repository": {
    "comment": {
      "name": "comment",
      "match": "//.*$"
    },
    "header": {
      "begin": "^\\s*([A-Z0-9]+):\\s*",
      "end": "$",
      "beginCaptures": {
        "1": {
          "name": "header.name"
        }
      },
      "patterns": [
        {
          "include": "#comment"
        },
        {
          "name": "header.parameter.prefix",
          "match": "(?<=^\\s*SUBTITLE:\\s*)(\\+\\+|--)"
        },
        {
          "name": "header.parameter",
          "begin": "\\G",
          "end": "(?=(\\s*//|\\s*$))"
        }
      ]
    },
    "chart": {
      "begin": "(?=^\\s*#START\\s)",
      "end": "(?=^\\s*#END\\s)",
      "patterns": [
        {
          "include": "#comment"
        },
        {
          "include": "#commandBranch"
        },
        {
          "include": "#command"
        },
        {
          "include": "#measure"
        }
      ]
    },
    "command": {
      "begin": "^\\s*(#[A-Z0-9]+)\\s+",
      "end": "$",
      "beginCaptures": {
        "1": {
          "name": "command.name"
        }
      },
      "patterns": [
        {
          "include": "#comment"
        },
        {
          "name": "command.parameter",
          "begin": "\\G",
          "end": "(?=(\\s*//|\\s*$))",
          "patterns": [
            {
              "name": "command.delimiter",
              "match": ","
            }
          ]
        }
      ]
    },
    "commandBranch": {
      "begin": "^\\s*(#(BRANCHSTART|N|E|M|BRANCHEND))\\s+",
      "end": "$",
      "beginCaptures": {
        "1": {
          "name": "command.name.branch"
        }
      },
      "patterns": [
        {
          "include": "#comment"
        },
        {
          "name": "command.parameter.branch",
          "begin": "\\G",
          "end": "(?=(\\s*//|\\s*$))",
          "patterns": [
            {
              "name": "command.delimiter.branch",
              "match": ","
            }
          ]
        }
      ]
    },
    "measure": {
      "name": "measure",
      "begin": "(?=^\\s*[0-9,])",
      "end": "((,)|$|(?=^\\s*#(END|BRANCHSTART|N|E|M|BRANCHEND)\\s))",
      "endCaptures": {
        "2": {
          "name": "measureEnd"
        }
      },
      "patterns": [
        {
          "include": "#comment"
        },
        {
          "include": "#notes"
        }
      ]
    },
    "notes": {
      "patterns": [
        {
          "name": "note.empty",
          "match": "0"
        },
        {
          "name": "note.don",
          "match": "1"
        },
        {
          "name": "note.ka",
          "match": "2"
        },
        {
          "name": "note.don.big",
          "match": "3"
        },
        {
          "name": "note.ka.big",
          "match": "4"
        },
        {
          "include": "#roll"
        },
        {
          "include": "#rollBig"
        },
        {
          "include": "#balloon"
        },
        {
          "include": "#balloonBig"
        },
        {
          "name": "note.end",
          "match": "8"
        }
      ]
    },
    "roll": {
      "name": "noteRange.roll",
      "begin": "(5)(0*)(,?)",
      "end": "(8|(?=[1-79])|(?=^\\s*#(END|BRANCHSTART|N|E|M|BRANCHEND)\\s))",
      "beginCaptures": {
        "1": {"name": "note.start"},
        "2": {"name": "note.empty"},
        "3": {"name": "measureEnd"}
      },
      "endCaptures": {
        "0": {"name": "note.end"}
      },
      "patterns": [
        {
          "include": "#comment"
        },
        {
          "include": "#commandBranch"
        },
        {
          "include": "#command"
        },
        {
          "include": "#rollMeasure"
        }
      ]
    },
    "rollBig": {
      "name": "noteRange.roll.big",
      "begin": "(6)(0*)(,?)",
      "end": "(8|(?=[1-79])|(?=^\\s*#(END|BRANCHSTART|N|E|M|BRANCHEND)\\s))",
      "beginCaptures": {
        "1": {"name": "note.start"},
        "2": {"name": "note.empty"},
        "3": {"name": "measureEnd"}
      },
      "endCaptures": {
        "0": {"name": "note.end"}
      },
      "patterns": [
        {
          "include": "#comment"
        },
        {
          "include": "#commandBranch"
        },
        {
          "include": "#command"
        },
        {
          "include": "#rollMeasure"
        }
      ]
    },
    "balloon": {
      "name": "noteRange.balloon",
      "begin": "(7)(0*)(,?)",
      "end": "(8|(?=[1-79])|(?=^\\s*#(END|BRANCHSTART|N|E|M|BRANCHEND)\\s))",
      "beginCaptures": {
        "1": {"name": "note.start"},
        "2": {"name": "note.empty"},
        "3": {"name": "measureEnd"}
      },
      "endCaptures": {
        "0": {"name": "note.end"}
      },
      "patterns": [
        {
          "include": "#comment"
        },
        {
          "include": "#commandBranch"
        },
        {
          "include": "#command"
        },
        {
          "include": "#rollMeasure"
        }
      ]
    },
    "balloonBig": {
      "name": "noteRange.balloon.big",
      "begin": "(9)(0*)(,?)",
      "end": "(8|(?=[1-79])|(?=^\\s*#(END|BRANCHSTART|N|E|M|BRANCHEND)\\s))",
      "beginCaptures": {
        "1": {"name": "note.start"},
        "2": {"name": "note.empty"},
        "3": {"name": "measureEnd"}
      },
      "endCaptures": {
        "0": {"name": "note.end"}
      },
      "patterns": [
        {
          "include": "#comment"
        },
        {
          "include": "#commandBranch"
        },
        {
          "include": "#command"
        },
        {
          "include": "#rollMeasure"
        }
      ]
    },
    "rollMeasure": {
      "begin": "(?=^\\s*[0,])",
      "end": "((,)|$|(?=[1-9]))",
      "endCaptures": {
        "2": {
          "name": "measureEnd"
        }
      },
      "patterns": [
        {
          "include": "#comment"
        },
        {
          "name": "note.empty",
          "match": "0"
        }
      ]
    }
  }
}
